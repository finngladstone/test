name: Monitor Site Changes
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  check-updates:
    runs-on: ubuntu-latest
    steps:
      - name: Download previous content
        uses: actions/download-artifact@v4
        with:
          name: site-content
          path: .
        continue-on-error: true
          
      - name: Fetch current site content
        run: |
          curl -s https://www.marukyu-koyamaen.co.jp/english/shop/products/catalog/matcha > current_content.html
          
      - name: Compare with previous version
        run: |
          if [ -f previous_content.html ]; then
            if ! diff -q current_content.html previous_content.html > /dev/null; then
              echo "🚨 Site has been updated!"
              echo "SITE_UPDATED=true" >> $GITHUB_ENV
              # Show the differences
              echo "Changes detected:"
              diff previous_content.html current_content.html || true
            else
              echo "✅ No changes detected"
              echo "SITE_UPDATED=false" >> $GITHUB_ENV
            fi
          else
            echo "📝 First run - saving baseline"
            echo "SITE_UPDATED=true" >> $GITHUB_ENV
          fi
          
      - name: Upload current content for next comparison
        uses: actions/upload-artifact@v4
        with:
          name: site-content
          path: current_content.html
          retention-days: 30
          
      - name: Notify on changes
        if: env.SITE_UPDATED == 'true'
        run: |
          echo "Site updated! Add your notification logic here"
          # Could send email, Slack message, create issue, etc.
